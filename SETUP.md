# Setup Guide

## Предварительные требования (Prerequisites)

Перед началом работы убедитесь, что у вас установлены:

1. **Node.js** (версия 18 или выше рекомендуется)
    - [Скачать Node.js](https://nodejs.org/)
2. **Cloudflared** (для управления туннелями)
    - Windows: `winget install --id Cloudflare.Cloudflared`
3. **n8n** (сервер автоматизации)
    - Должен быть настроен для возврата **Plain Text** в Webhook ответе (см. `workflows/WebChat.md`).

## Запуск проекта

В корневой директории проекта выполните одну команду:

```bash
npm start
```

**Что происходит при запуске:**

- Скрипт `start_server.bat` очищает зависшие процессы Node и Cloudflared.
- Запускается локальный сервер для фронтенда (`localhost:3000`).
- Запускается прокси-сервер для Webhook (`localhost:3001`).
- Подключаются туннели для публичного доступа.

## Настройка туннелей

Проект настроен на работу с доменами `chat.mup.me` и `n8n.mup.me`.

- Если вы используете свои домены, обновите файлы `chat-config.yml` и `n8n-config.yml`.
- Убедитесь, что вы выполнили `cloudflared tunnel login`.

## Troubleshooting (Решение проблем)

### Кнопка "Начать чат" не работает

Проверьте консоль браузера (`F12`). Если видите ошибку загрузки ресурсов, убедитесь, что `npm start` отработал без ошибок.

### Вебхук возвращает JSON вместо текста

В n8n workflow в узле **Respond to Webhook** обязательно выберите `Respond With: Text`. Иначе фронтенд может отображать JSON-структуру вместо чистого текста.

### Зависание терминала (Windows)

Мы используем специальный скрипт `kill_old_processes.ps1`, который решает большинство проблем с блокировкой портов. Если проблема сохраняется, перезапустите VS Code.
